(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4880],{8472:function(s,n,o){(window.__NEXT_P=window.__NEXT_P||[]).push(["/docs/resources/build",function(){return o(740)}])},740:function(s,n,o){"use strict";o.r(n),o.d(n,{__N_SSG:function(){return i}});var e=o(5893),a=o(1151),r=o(8691);function t(s){let n=Object.assign({h1:"h1",code:"code",p:"p",h2:"h2",hr:"hr",pre:"pre"},(0,a.ah)(),s.components),{Intro:o,Properties:t,Property:i}=n;return o||l("Intro",!0),t||l("Properties",!0),i||l("Property",!0),(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(n.h1,{children:["Build ",(0,e.jsx)(n.code,{children:"build"})]}),"\n",(0,e.jsxs)(o,{children:[(0,e.jsxs)(n.p,{children:["Builds containers or applications that can be used in blueprints. The build stanza runs a ",(0,e.jsx)(n.code,{children:"docker build"}),"\nusing the ",(0,e.jsx)(n.code,{children:"dockerfile"})," or ",(0,e.jsx)(n.code,{children:"context"})," defined in the ",(0,e.jsx)(n.code,{children:"container"})," stanza. You can use\nthis feature to build container images that can be started directly using the ",(0,e.jsx)(n.code,{children:"container"})," resource,\nor copied to ",(0,e.jsx)(n.code,{children:"nomad"})," or ",(0,e.jsx)(n.code,{children:"kubernetes"}),"."]}),(0,e.jsxs)(n.p,{children:["In addition to building containers, ",(0,e.jsx)(n.code,{children:"build"})," blocks can be used to build application code in a docker\ncontainer, the product of which can be copied to the local file system using the optional ",(0,e.jsx)(n.code,{children:"output"})," stanza."]})]}),"\n",(0,e.jsx)(n.h2,{id:"properties",children:"Properties"}),"\n",(0,e.jsxs)(t,{children:[(0,e.jsx)(i,{name:"container",type:"#container",value:"",children:(0,e.jsx)(n.p,{children:"Build a container from the given file and context.\nImages are cached in the local Docker engine using the following convention."})}),(0,e.jsx)(i,{name:"output",type:"#output",value:"",children:(0,e.jsx)(n.p,{children:"Copy artifacts from the built container image to the local filesystem."})}),(0,e.jsx)(i,{name:"registry",type:"#registry",value:"",children:(0,e.jsx)(n.p,{children:"Registry credentials for pushing images to a remote registry."})}),(0,e.jsx)(i,{name:"image",type:"string",value:"",readonly:!0,children:(0,e.jsx)(n.p,{children:"The built image reference that can be used by other resources."})}),(0,e.jsx)(i,{name:"build_checksum",type:"string",value:"",readonly:!0,children:(0,e.jsx)(n.p,{children:"A checksum of the build context used to determine if the image needs to be rebuilt."})})]}),"\n",(0,e.jsx)(n.hr,{}),"\n",(0,e.jsx)(n.h2,{id:"container",children:"container"}),"\n",(0,e.jsx)(n.pre,{language:"hcl",code:'container {\n  dockerfile = "Dockerfile"\n  context    = "./src"\n}\n',children:(0,e.jsx)(n.code,{className:"language-hcl",children:'<span><span style="color: var(--shiki-token-keyword)">container</span><span style="color: var(--shiki-color-text)"> {</span></span>\n<span><span style="color: var(--shiki-color-text)">  dockerfile </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&quot;Dockerfile&quot;</span></span>\n<span><span style="color: var(--shiki-color-text)">  context    </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&quot;./src&quot;</span></span>\n<span><span style="color: var(--shiki-color-text)">}</span></span>\n<span></span>'})}),"\n",(0,e.jsxs)(t,{children:[(0,e.jsx)(i,{name:"dockerfile",type:"string",value:"Dockerfile",children:(0,e.jsx)(n.p,{children:"Docker file to use for the build."})}),(0,e.jsx)(i,{name:"context",type:"string",required:"true",value:"",children:(0,e.jsx)(n.p,{children:"Path to the context for the build."})}),(0,e.jsx)(i,{name:"tag",type:"string",value:"",children:(0,e.jsx)(n.p,{children:"Tag to tag the resulting image with."})}),(0,e.jsx)(i,{name:"args",type:"map[string]string",value:"",children:(0,e.jsx)(n.p,{children:"Build args to pass to the build."})}),(0,e.jsx)(i,{name:"ignore",type:"[]string",value:"",children:(0,e.jsx)(n.p,{children:"Patterns to ignore when calculating the build context checksum (similar to .dockerignore format)."})})]}),"\n",(0,e.jsx)(n.hr,{}),"\n",(0,e.jsx)(n.h2,{id:"output",children:"output"}),"\n",(0,e.jsx)(n.pre,{language:"hcl",code:'output {\n  source = "/bin/myapp"\n  destination = "${data("local_app")}/bin"\n}\n',children:(0,e.jsx)(n.code,{className:"language-hcl",children:'<span><span style="color: var(--shiki-token-keyword)">output</span><span style="color: var(--shiki-color-text)"> {</span></span>\n<span><span style="color: var(--shiki-color-text)">  source </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&quot;/bin/myapp&quot;</span></span>\n<span><span style="color: var(--shiki-color-text)">  destination </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&quot;</span><span style="color: var(--shiki-token-keyword)">${</span><span style="color: var(--shiki-token-function)">data</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-string-expression)">&quot;local_app&quot;</span><span style="color: var(--shiki-color-text)">)</span><span style="color: var(--shiki-token-keyword)">}</span><span style="color: var(--shiki-token-string-expression)">/bin&quot;</span></span>\n<span><span style="color: var(--shiki-color-text)">}</span></span>\n<span></span>'})}),"\n",(0,e.jsxs)(t,{children:[(0,e.jsx)(i,{name:"source",type:"string",value:"",children:(0,e.jsx)(n.p,{children:"The source directory or file to be copied from the built container"})}),(0,e.jsx)(i,{name:"destination",type:"string",value:"",children:(0,e.jsx)(n.p,{children:"The location to copy the files or directory to"})})]}),"\n",(0,e.jsx)(n.hr,{}),"\n",(0,e.jsx)(n.h2,{id:"registry",children:"registry"}),"\n",(0,e.jsx)(n.p,{children:"Registry credentials for pushing images to a remote registry."}),"\n",(0,e.jsx)(n.pre,{language:"hcl",code:'registry {\n  name     = "docker.io/myuser/myimage"\n  username = "myuser"\n  password = "mypassword"\n}\n',children:(0,e.jsx)(n.code,{className:"language-hcl",children:'<span><span style="color: var(--shiki-token-keyword)">registry</span><span style="color: var(--shiki-color-text)"> {</span></span>\n<span><span style="color: var(--shiki-color-text)">  name     </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&quot;docker.io/myuser/myimage&quot;</span></span>\n<span><span style="color: var(--shiki-color-text)">  username </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&quot;myuser&quot;</span></span>\n<span><span style="color: var(--shiki-color-text)">  password </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&quot;mypassword&quot;</span></span>\n<span><span style="color: var(--shiki-color-text)">}</span></span>\n<span></span>'})}),"\n",(0,e.jsxs)(t,{children:[(0,e.jsx)(i,{name:"name",type:"string",value:"",children:(0,e.jsx)(n.p,{children:"The full image name including registry (e.g., docker.io/myuser/myimage)."})}),(0,e.jsx)(i,{name:"username",type:"string",value:"",children:(0,e.jsx)(n.p,{children:"Username for registry authentication."})}),(0,e.jsx)(i,{name:"password",type:"string",value:"",children:(0,e.jsx)(n.p,{children:"Password for registry authentication."})})]}),"\n",(0,e.jsx)(r.default,{}),"\n",(0,e.jsx)(n.h2,{id:"examples",children:"Examples"}),"\n",(0,e.jsx)(n.p,{children:"Container build"}),"\n",(0,e.jsx)(n.pre,{language:"hcl",code:'resource "build" "app" {\n  container {\n    dockerfile = "Dockerfile"\n    context    = "./src"\n  }\n}\n\nresource "container" "app" {\n  image {\n    name = resource.build.app.image\n  }\n\n  command = ["/bin/app"]\n\n  port {\n    local  = 9090\n    remote = 9090\n    host   = 9090\n  }\n\n  network {\n    id = resource.network.onprem.meta.id\n  }\n}\n',children:(0,e.jsx)(n.code,{className:"language-hcl",children:'<span><span style="color: var(--shiki-token-keyword)">resource</span><span style="color: var(--shiki-token-string-expression)"> &quot;build&quot; &quot;app&quot;</span><span style="color: var(--shiki-color-text)"> {</span></span>\n<span><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-keyword)">container</span><span style="color: var(--shiki-color-text)"> {</span></span>\n<span><span style="color: var(--shiki-color-text)">    dockerfile </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&quot;Dockerfile&quot;</span></span>\n<span><span style="color: var(--shiki-color-text)">    context    </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&quot;./src&quot;</span></span>\n<span><span style="color: var(--shiki-color-text)">  }</span></span>\n<span><span style="color: var(--shiki-color-text)">}</span></span>\n<span></span>\n<span><span style="color: var(--shiki-token-keyword)">resource</span><span style="color: var(--shiki-token-string-expression)"> &quot;container&quot; &quot;app&quot;</span><span style="color: var(--shiki-color-text)"> {</span></span>\n<span><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-keyword)">image</span><span style="color: var(--shiki-color-text)"> {</span></span>\n<span><span style="color: var(--shiki-color-text)">    name </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> resource</span><span style="color: var(--shiki-token-constant)">.</span><span style="color: var(--shiki-color-text)">build</span><span style="color: var(--shiki-token-constant)">.</span><span style="color: var(--shiki-color-text)">app</span><span style="color: var(--shiki-token-constant)">.</span><span style="color: var(--shiki-color-text)">image</span></span>\n<span><span style="color: var(--shiki-color-text)">  }</span></span>\n<span></span>\n<span><span style="color: var(--shiki-color-text)">  command </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> [</span><span style="color: var(--shiki-token-string-expression)">&quot;/bin/app&quot;</span><span style="color: var(--shiki-color-text)">]</span></span>\n<span></span>\n<span><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-keyword)">port</span><span style="color: var(--shiki-color-text)"> {</span></span>\n<span><span style="color: var(--shiki-color-text)">    local  </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">9090</span></span>\n<span><span style="color: var(--shiki-color-text)">    remote </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">9090</span></span>\n<span><span style="color: var(--shiki-color-text)">    host   </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-constant)">9090</span></span>\n<span><span style="color: var(--shiki-color-text)">  }</span></span>\n<span></span>\n<span><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-keyword)">network</span><span style="color: var(--shiki-color-text)"> {</span></span>\n<span><span style="color: var(--shiki-color-text)">    id </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> resource</span><span style="color: var(--shiki-token-constant)">.</span><span style="color: var(--shiki-color-text)">network</span><span style="color: var(--shiki-token-constant)">.</span><span style="color: var(--shiki-color-text)">onprem</span><span style="color: var(--shiki-token-constant)">.</span><span style="color: var(--shiki-color-text)">meta</span><span style="color: var(--shiki-token-constant)">.</span><span style="color: var(--shiki-color-text)">id</span></span>\n<span><span style="color: var(--shiki-color-text)">  }</span></span>\n<span><span style="color: var(--shiki-color-text)">}</span></span>\n<span></span>'})}),"\n",(0,e.jsx)(n.p,{children:"Application build"}),"\n",(0,e.jsx)(n.pre,{language:"hcl",code:'resource "build" "app" {\n  container {\n    dockerfile = "Dockerfile"\n    context    = "./src"\n  }\n\n  output {\n    source = "/go/src/github.com/jumppad-labs/jumppad/bin"\n    destination = "${data("local_app")}/bin"\n  }\n}\n\nresource "exec" "app" {\n  script = <<-EOF\n    jumppad up ./config\n  EOF\n}\n',children:(0,e.jsx)(n.code,{className:"language-hcl",children:'<span><span style="color: var(--shiki-token-keyword)">resource</span><span style="color: var(--shiki-token-string-expression)"> &quot;build&quot; &quot;app&quot;</span><span style="color: var(--shiki-color-text)"> {</span></span>\n<span><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-keyword)">container</span><span style="color: var(--shiki-color-text)"> {</span></span>\n<span><span style="color: var(--shiki-color-text)">    dockerfile </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&quot;Dockerfile&quot;</span></span>\n<span><span style="color: var(--shiki-color-text)">    context    </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&quot;./src&quot;</span></span>\n<span><span style="color: var(--shiki-color-text)">  }</span></span>\n<span></span>\n<span><span style="color: var(--shiki-color-text)">  </span><span style="color: var(--shiki-token-keyword)">output</span><span style="color: var(--shiki-color-text)"> {</span></span>\n<span><span style="color: var(--shiki-color-text)">    source </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&quot;/go/src/github.com/jumppad-labs/jumppad/bin&quot;</span></span>\n<span><span style="color: var(--shiki-color-text)">    destination </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> </span><span style="color: var(--shiki-token-string-expression)">&quot;</span><span style="color: var(--shiki-token-keyword)">${</span><span style="color: var(--shiki-token-function)">data</span><span style="color: var(--shiki-color-text)">(</span><span style="color: var(--shiki-token-string-expression)">&quot;local_app&quot;</span><span style="color: var(--shiki-color-text)">)</span><span style="color: var(--shiki-token-keyword)">}</span><span style="color: var(--shiki-token-string-expression)">/bin&quot;</span></span>\n<span><span style="color: var(--shiki-color-text)">  }</span></span>\n<span><span style="color: var(--shiki-color-text)">}</span></span>\n<span></span>\n<span><span style="color: var(--shiki-token-keyword)">resource</span><span style="color: var(--shiki-token-string-expression)"> &quot;exec&quot; &quot;app&quot;</span><span style="color: var(--shiki-color-text)"> {</span></span>\n<span><span style="color: var(--shiki-color-text)">  script </span><span style="color: var(--shiki-token-keyword)">=</span><span style="color: var(--shiki-color-text)"> &lt;&lt;-EOF</span></span>\n<span><span style="color: var(--shiki-color-text)">    jumppad up ./config</span></span>\n<span><span style="color: var(--shiki-color-text)">  EOF</span></span>\n<span><span style="color: var(--shiki-color-text)">}</span></span>\n<span></span>'})})]})}var i=!0;function l(s,n){throw Error("Expected "+(n?"component":"object")+" `"+s+"` to be defined: you likely forgot to import, pass, or provide it.")}n.default=function(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:n}=Object.assign({},(0,a.ah)(),s.components);return n?(0,e.jsx)(n,Object.assign({},s,{children:(0,e.jsx)(t,s)})):t(s)}},8691:function(s,n,o){"use strict";o.r(n),o.d(n,{__N_SSG:function(){return t}});var e=o(5893),a=o(1151);function r(s){let n=Object.assign({h2:"h2",p:"p",code:"code",a:"a"},(0,a.ah)(),s.components);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(n.h2,{id:"meta_properties",children:"Meta Properties"}),"\n",(0,e.jsxs)(n.p,{children:["In addition to the main properties, all resources have ",(0,e.jsx)(n.code,{children:"meta"})," properties, such\nas the ",(0,e.jsx)(n.code,{children:"id"})," of the resource. To see the list of these properties please see the\n",(0,e.jsx)(n.code,{children:"Meta Properties"})," section in the documentation ",(0,e.jsx)(n.a,{href:"/docs/resources/meta",children:"/docs/resources/meta"}),"."]})]})}var t=!0;n.default=function(){let s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:n}=Object.assign({},(0,a.ah)(),s.components);return n?(0,e.jsx)(n,Object.assign({},s,{children:(0,e.jsx)(r,s)})):r(s)}}},function(s){s.O(0,[9774,2888,179],function(){return s(s.s=8472)}),_N_E=s.O()}]);